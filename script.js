// JavaScript –¥–ª—è —Å–∞–π—Ç–∞ —Å–ª–µ–ø—ã—Ö –ª—é–¥–µ–π
document.addEventListener('DOMContentLoaded', function() {
    
    // –°–æ–∑–¥–∞–µ–º –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    let audioContext;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
    function initAudio() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–≤—É–∫–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
    function playBeep(frequency = 440, duration = 200, volume = 0.1) {
        initAudio();
        
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = frequency;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration / 1000);
    }

    // –ó–≤—É–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const sounds = {
        header: () => playBeep(800, 300, 0.1),
        h2: () => playBeep(600, 200, 0.08),
        p: () => playBeep(400, 150, 0.06),
        li: () => playBeep(500, 100, 0.05),
        braille: () => playBeep(300, 400, 0.12),
        button: () => playBeep(1000, 250, 0.15),
        blockquote: () => playBeep(350, 300, 0.08)
    };

    // Reading area elements
    let readingArea = null;
    let originalTexts = new Map();

     // –°–∏—Å—Ç–µ–º–∞ —Å–ª–æ–µ–≤ - –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Å–Ω–∏–∑—É, –ë—Ä–∞–π–ª—å —Å–≤–µ—Ä—Ö—É
     function initializeLayers(element, englishText) {
         if (element.dataset.layered) return;
         
         const brailleText = element.textContent;
         
         // –°–Ω–∞—á–∞–ª–∞ –∏–∑–º–µ—Ä—è–µ–º –≤—ã—Å–æ—Ç—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞
         const tempDiv = document.createElement('div');
         tempDiv.style.cssText = `
             position: absolute;
             visibility: hidden;
             width: ${element.offsetWidth}px;
             font-family: ${window.getComputedStyle(element).fontFamily};
             font-size: ${window.getComputedStyle(element).fontSize};
             line-height: ${window.getComputedStyle(element).lineHeight};
             letter-spacing: ${window.getComputedStyle(element).letterSpacing};
             padding: 0.8rem;
             box-sizing: border-box;
             word-wrap: break-word;
             white-space: normal;
         `;
         tempDiv.textContent = Math.max(brailleText.length, englishText.length) > brailleText.length ? englishText : brailleText;
         document.body.appendChild(tempDiv);
         const contentHeight = tempDiv.offsetHeight;
         document.body.removeChild(tempDiv);
         
         // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
         element.style.minHeight = contentHeight + 'px';
         element.innerHTML = '';
         element.style.position = 'relative';
         
         // –ê–Ω–≥–ª–∏–π—Å–∫–∏–π —Å–ª–æ–π (—Å–Ω–∏–∑—É, –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã–π)
         const englishLayer = document.createElement('div');
         englishLayer.className = 'english-layer';
         englishLayer.textContent = englishText;
         
         // –ë—Ä–∞–π–ª—å —Å–ª–æ–π (—Å–≤–µ—Ä—Ö—É, –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, –∏—Å—á–µ–∑–∞–µ—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ –∫—É—Ä—Å–æ—Ä–∞)
         const brailleLayer = document.createElement('div');
         brailleLayer.className = 'braille-layer';
         brailleLayer.textContent = brailleText;
         
         element.appendChild(englishLayer);
         element.appendChild(brailleLayer);
         element.dataset.layered = 'true';
     }

     function updateLayers(element, mouseX, mouseY) {
         const brailleLayer = element.querySelector('.braille-layer');
         if (!brailleLayer) return;
         
         // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–∞-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
         const elementRect = element.getBoundingClientRect();
         const relativeX = mouseX - elementRect.left;
         const relativeY = mouseY - elementRect.top;
         const radius = 50; // –†–∞–¥–∏—É—Å –∫—Ä—É–≥–∞
         
         // –ú–∞—Å–∫–∞ –¥–ª—è –ë—Ä–∞–π–ª—è - –¥–µ–ª–∞–µ–º "–¥—ã—Ä–∫—É" –≤ –æ–±–ª–∞—Å—Ç–∏ –∫—É—Ä—Å–æ—Ä–∞
         const brailleMask = `radial-gradient(circle ${radius}px at ${relativeX}px ${relativeY}px, transparent 0%, transparent ${radius}px, black ${radius + 1}px)`;
         
         // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å–∫—É, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤ —Å–ª–æ–µ –ë—Ä–∞–π–ª—è
         brailleLayer.style.mask = brailleMask;
         brailleLayer.style.webkitMask = brailleMask;
     }

     function restoreLayers(element) {
         const brailleLayer = element.querySelector('.braille-layer');
         if (brailleLayer) {
             brailleLayer.style.mask = 'none';
             brailleLayer.style.webkitMask = 'none';
         }
     }

     function createReadingArea() {
         readingArea = document.createElement('div');
         readingArea.style.cssText = `
             position: fixed;
             width: 100px;
             height: 100px;
             border: 2px solid rgba(255, 255, 255, 0.5);
             border-radius: 50%;
             pointer-events: none;
             z-index: 1000;
             background: transparent;
             opacity: 0;
             transition: opacity 0.2s ease;
         `;
         document.body.appendChild(readingArea);
     }

     function showReadingArea(e) {
         if (!readingArea) createReadingArea();
         readingArea.style.left = (e.clientX - 50) + 'px';
         readingArea.style.top = (e.clientY - 50) + 'px';
         readingArea.style.opacity = '1';
     }

     function hideReadingArea() {
         if (readingArea) {
             readingArea.style.opacity = '0';
         }
     }

    // –î–æ–±–∞–≤–ª—è–µ–º –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º
    function addSoundEffects() {
        // –ó–∞–≥–æ–ª–æ–≤–∫–∏
        document.querySelectorAll('h1, header').forEach(el => {
            el.addEventListener('mouseenter', sounds.header);
        });

         // –®—Ä–∏—Ñ—Ç –ë—Ä–∞–π–ª—è —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Å–ª–æ–µ–≤
         document.querySelectorAll('.braille-text').forEach(el => {
             el.addEventListener('mouseenter', (e) => {
                 sounds.braille();
                 const englishText = el.getAttribute('data-english');
                 if (englishText) {
                     showReadingArea(e);
                     initializeLayers(el, englishText);
                     updateLayers(el, e.clientX, e.clientY);
                 }
             });
             
             el.addEventListener('mousemove', (e) => {
                 if (readingArea && readingArea.style.opacity === '1') {
                     readingArea.style.left = (e.clientX - 50) + 'px';
                     readingArea.style.top = (e.clientY - 50) + 'px';
                     
                     updateLayers(el, e.clientX, e.clientY);
                 }
             });
             
             el.addEventListener('mouseleave', () => {
                 hideReadingArea();
                 restoreLayers(el);
             });
         });

        // –û–±—ã—á–Ω—ã–π —à—Ä–∏—Ñ—Ç –ë—Ä–∞–π–ª—è (–≤ —Ö–µ–¥–µ—Ä–µ –∏ —Ñ—É—Ç–µ—Ä–µ)
        document.querySelectorAll('.braille').forEach(el => {
            el.addEventListener('mouseenter', sounds.braille);
        });

        // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞
        document.querySelectorAll('.sound-button').forEach(el => {
            el.addEventListener('mouseenter', sounds.button);
            el.addEventListener('click', () => {
                playBeep(1200, 500, 0.2);
                showMessage("Sound is working! üîä");
            });
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    function showMessage(text) {
        // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
        const existingMessage = document.querySelector('.floating-message');
        if (existingMessage) {
            existingMessage.remove();
        }

        const message = document.createElement('div');
        message.className = 'floating-message';
        message.textContent = text;
        message.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            color: #000;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            animation: fadeInOut 2s ease-in-out;
        `;

        document.body.appendChild(message);

        // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            if (message.parentNode) {
                message.remove();
            }
        }, 2000);
    }

    // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20%, 80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }
    `;
    document.head.appendChild(style);

    // –°–µ–∫—Ä–µ—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–≥–æ –Ω–µ –¥–≤–∏–≥–∞–µ—Ç –º—ã—à—å
    let mouseTimer;
    let mouseInactive = false;

    function resetMouseTimer() {
        clearTimeout(mouseTimer);
        mouseInactive = false;
        
        mouseTimer = setTimeout(() => {
            mouseInactive = true;
            showMessage("ü¶Ø Where is your mouse? We can't see it!");
            playBeep(200, 1000, 0.1);
        }, 10000); // 10 seconds without mouse movement
    }

    document.addEventListener('mousemove', resetMouseTimer);
    resetMouseTimer();

    // Special easter egg: konami code for "sighted" people
    let konamiCode = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65]; // ‚Üë ‚Üë ‚Üì ‚Üì ‚Üê ‚Üí ‚Üê ‚Üí B A
    let konamiIndex = 0;

    document.addEventListener('keydown', function(e) {
        if (e.keyCode === konamiCode[konamiIndex]) {
            konamiIndex++;
            if (konamiIndex === konamiCode.length) {
                showMessage("üéâ Secret code activated! Now you can see everything!");
                document.body.style.background = 'linear-gradient(45deg, #ff0000, #00ff00, #0000ff)';
                document.body.style.color = '#ffffff';
                
                // Musical melody
                setTimeout(() => playBeep(523, 200), 0);    // C
                setTimeout(() => playBeep(659, 200), 200);  // E
                setTimeout(() => playBeep(784, 200), 400);  // G
                setTimeout(() => playBeep(1047, 400), 600); // C
                
                konamiIndex = 0;
                
                // Return to normal view after 5 seconds
                setTimeout(() => {
                    document.body.style.background = '#000000';
                    document.body.style.color = '#333333';
                }, 5000);
            }
        } else {
            konamiIndex = 0;
        }
    });



    // Add CSS for pulse animation
    const pulseStyle = document.createElement('style');
    pulseStyle.textContent = `
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
    `;
    document.head.appendChild(pulseStyle);

    // Initialize sound effects
    addSoundEffects();

    // Welcome message
    setTimeout(() => {
        showMessage("ü¶Ø Welcome! Hover over elements for audio guidance");
        playBeep(440, 500, 0.1);
    }, 1000);

    // "Virtual screen" effect
    let screenReader = false;
    document.addEventListener('keydown', function(e) {
        // Space key activates "screen reading"
        if (e.code === 'Space' && e.ctrlKey) {
            e.preventDefault();
            screenReader = !screenReader;
            
            if (screenReader) {
                showMessage("üì¢ Screen reader mode ON!");
                document.body.style.filter = 'invert(1)';
                playBeep(800, 300, 0.1);
            } else {
                showMessage("üì¢ Screen reader mode OFF!");
                document.body.style.filter = 'none';
                playBeep(400, 300, 0.1);
            }
        }
    });

    console.log('ü¶Ø Website for blind people loaded! Use Ctrl+Space to toggle screen mode.');
});
